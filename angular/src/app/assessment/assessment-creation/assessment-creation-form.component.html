<div (click)="setUneditable()">
    <div class="container" *ngIf="true" >
        <mat-stepper [linear]="true" #stepper class="bg-light">
            <!-- Step 1: Assessment Info -->
            <mat-step [stepControl]="assessmentDetailFormGroup" label="Details">
                <form [formGroup]="assessmentDetailFormGroup">
                    <div class="form-group">
                        <label for="assessmentName">Assessment Name</label>
                        <input
                            type="text"
                            class="form-control"
                            formControlName="assessmentName"
                            id="assessmentName"
                            placeholder="Enter assessment name"
                            name="assessmentName"
                        />
                        <error-message
                            ngDefaultControl
                            [formControl]="assessmentName"
                        ></error-message>
                    </div>
                    <div class="form-group">
                        <label for="assessmentType">Assessment Type</label>
                        <select
                            class="form-select"
                            name="assessmentTypes"
                            id="assessmentTypes"
                            formControlName="assessmentType"
                        >
                            <option
                                *ngFor="let type of assessmentTypes"
                                [value]="type"
                                [selected]="type == 'essay_based' ? true : false"
                            >
                                {{ type }}
                            </option>
                        </select>
                        <error-message
                            ngDefaultControl
                            [formControl]="assessmentType"
                        ></error-message>
                    </div>
                    <div class="form-group">
                        <label for="subject">Subject</label>
                        <select
                            class="form-select"
                            name="subject"
                            id="subject"
                            formControlName="subject"
                        >
                            <option
                                *ngFor="let subject of subjects"
                                [value]="subject.id"
                            >
                                {{ subject.name }}
                            </option>
                        </select>
                        <error-message
                            ngDefaultControl
                            [formControl]="subject"
                        ></error-message>
                    </div>
                    <div class="form-group">
                        <label for="defaultSetting">Default Setting</label>
                        <select
                            class="form-select"
                            name="defaultSetting"
                            id="defaultSetting"
                            formControlName="defaultSetting"
                        >
                            <option
                                *ngFor="let setting of markingSettings"
                                [value]="setting"
                            >
                                {{ setting }}
                            </option>
                        </select>
                        <error-message
                            ngDefaultControl
                            [formControl]="defaultSetting"
                        ></error-message>
                    </div>
                    <div>
                        <button
                            class="btn btn-primary"
                            matStepperNext
                            (click)="validateForm(assessmentDetailFormGroup)"
                        >
                            Next
                        </button>
                    </div>
                </form>
            </mat-step>
            <!-- Step 2: Question -->
            <mat-step [stepControl]="questionFormGroup" label="Questions">
                <form [formGroup]="questionFormGroup" id="questionForm">
                    <div class="form-group d-flex align-items-center mt-2">
                        <label for="totalMark" class="mr-4">Total Mark</label>
                        <input
                            type="text"
                            class="form-control w-25 d-block ml-auto"
                            id="totalMark"
                            name="totalMark"
                            value="{{ getTotalMark() }}"
                            disabled
                        />
                    </div>
                </form>

                <button
                    class="btn btn-primary d-block ml-auto"
                    (click)="addQuestion()"
                >
                    + Add Question
                </button>

                <table
                    mat-table
                    [dataSource]="questions"
                    class="mat-elevation-z8 w-100 my-4"
                >
                    <ng-container matColumnDef="drag">
                        <th mat-header-cell *matHeaderCellDef style="width: 5%">
                            Drag
                        </th>
                        <td mat-cell *matCellDef="let element">
                            <fa-icon [icon]="faEllipsisV"></fa-icon>
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="no">
                        <th mat-header-cell *matHeaderCellDef style="width: 10%">
                            No.
                        </th>
                        <td mat-cell *matCellDef="let element">
                            <span *ngIf="!element.isEdit">
                                {{ element.no }}
                            </span>
                            <span *ngIf="element.isEdit">
                                <input
                                    type="text"
                                    class="form-control"
                                    [(ngModel)]="element.no"
                                />
                            </span>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="question">
                        <th mat-header-cell *matHeaderCellDef style="width: 60%">
                            Questions
                        </th>
                        <td mat-cell *matCellDef="let element">
                            <span *ngIf="!element.isEdit">
                                {{ element.value.question }}
                            </span>
                            <span *ngIf="element.isEdit">
                                <input
                                    type="text"
                                    class="form-control"
                                    [(ngModel)]="element.value.question"
                                />
                            </span>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="marks">
                        <th mat-header-cell *matHeaderCellDef style="width: 10%">
                            Marks
                        </th>
                        <td mat-cell *matCellDef="let element">
                            <span *ngIf="!element.isEdit">
                                {{ element.value.marks }}
                            </span>
                            <span *ngIf="element.isEdit">
                                <input
                                    type="number"
                                    class="form-control"
                                    [(ngModel)]="element.value.marks"
                                />
                            </span>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="actions">
                        <th
                            mat-header-cell
                            *matHeaderCellDef
                            style="width: 20%"
                        ></th>
                        <td mat-cell *matCellDef="let element">
                            <div *ngIf="!element.isEdit" class="text-end">
                                <button
                                    class="btn btn-link"
                                    (click)="deleteQuestion(element)"
                                >
                                    <fa-icon
                                        [icon]="faTrashAlt"
                                        style="color: red"
                                    ></fa-icon>
                                </button>
                                <button
                                    (click)="updateQuestion(element)"
                                    class="btn btn-outline-primary"
                                >
                                    Edit
                                </button>
                            </div>
                            <div *ngIf="element.isEdit" class="text-end">
                                <button
                                    (click)="updateQuestion(element)"
                                    class="btn btn-primary"
                                >
                                    Save
                                </button>
                            </div>
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="questionDisplayedColumns"></tr>
                    <tr
                        mat-row
                        *matRowDef="let row; columns: questionDisplayedColumns"
                    ></tr>
                </table>
                <button matStepperPrevious class="btn btn-outline-primary mr-2">
                    Back
                </button>
                <button matStepperNext class="btn btn-primary">Next</button>
            </mat-step>

            <!-- Step 3: Rubrics -->
            <mat-step [stepControl]="rubricFormGroup" label="Rubrics">
                <!-- TODO: 20 APRIL -->
                <button
                    class="btn btn-primary d-block ml-auto"
                    (click)="addRubricsRow($event)"
                >
                    + Add Row
                </button>
                <button
                    class="btn btn-primary d-block ml-auto"
                    (click)="addRubricsColumn($event)"
                >
                    + Add Columns
                </button>
                <table
                    mat-table
                    [dataSource]="rubrics.criterion"
                    class="mat-elevation-z8 w-100 my-4"
                >
                    <ng-container
                        *ngFor="
                            let col of getRubricsMarksRange();
                            let colIndex = index
                        "
                        matColumnDef="{{
                            col === 'criteria' ? col : col.min + ' - ' + col.max
                        }}"
                    >
                        <!-- the header-->
                        <th mat-header-cell *matHeaderCellDef>
                            <div>
                                <span *ngIf="col === 'criteria'">Criteria</span>
                                <span *ngIf="col !== 'criteria'">
                                    <span *ngIf="rubrics.isEdit">
                                        <input
                                            type="text"
                                            class="form-control"
                                            [(ngModel)]="col.min"
                                        />
                                        -
                                        <input
                                            type="text"
                                            class="form-control"
                                            [(ngModel)]="col.max"
                                        />
                                    </span>
                                    <span *ngIf="!rubrics.isEdit">
                                        {{ col.min }} - {{ col.max }}
                                    </span>
                                </span>
                            </div>
                        </th>
                        <td mat-cell *matCellDef="let element">
                            <div *ngIf="colIndex == 0">
                                <span *ngIf="!element.isEdit">
                                    {{ element.title }}
                                    <br />
                                    {{ element.description }}
                                    <br />
                                    {{ element.totalMarks }}
                                </span>
                                <span *ngIf="element.isEdit">
                                    <input
                                        type="text"
                                        class="form-control"
                                        [(ngModel)]="element.title"
                                    />
                                    <input
                                        type="text"
                                        class="form-control"
                                        [(ngModel)]="element.description"
                                    />
                                    <input
                                        type="text"
                                        class="form-control"
                                        [(ngModel)]="element.totalMarks"
                                    />
                                </span>
                            </div>
                            <div *ngIf="colIndex !== 0">
                                <span *ngIf="!element.isEdit">
                                    {{ element.columns[colIndex - 1].description }}
                                </span>
                                <span *ngIf="element.isEdit">
                                    <textarea
                                        placeholder="description..."
                                        class="form-control"
                                        [(ngModel)]="
                                            element.columns[colIndex - 1]
                                                .description
                                        "
                                    ></textarea>
                                </span>
                            </div>
                        </td>
                    </ng-container>
                    <tr
                        mat-header-row
                        *matHeaderRowDef="getRubricsMarksRangeString()"
                    ></tr>
                    <tr
                        mat-row
                        (click)="$event.stopPropagation();"
                        (dblclick)="setUneditable(); row.isEdit = true"
                        *matRowDef="let row; columns: getRubricsMarksRangeString()"
                    ></tr>
                </table>
                <button matStepperPrevious class="btn btn-outline-primary mr-2">
                    Back
                </button>
                <button matStepperNext class="btn btn-primary">Next</button>
            </mat-step>

            <mat-step label="Done">
                <p>You are now done.</p>
                <div>
                    <button matStepperPrevious>Back</button>
                    <button (click)="onSubmit()">submit</button>
                </div>
            </mat-step>
        </mat-stepper>

    </div>

</div>
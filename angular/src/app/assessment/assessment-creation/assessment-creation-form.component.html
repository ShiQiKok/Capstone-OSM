<ng-template #subjectCreationModal let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Create a new subject</h4>
        <button
            type="button"
            class="btn-close"
            aria-label="Close"
            (click)="modal.dismiss('Cross click')"
        ></button>
    </div>
    <div class="modal-body">
        <form [formGroup]="subjectFormGroup" id="subjectFormGroup">
            <div class="form-group">
                <label for="newSubject">Subject Name</label>
                <input
                    type="text"
                    class="form-control"
                    formControlName="newSubject"
                    id="newSubject"
                    placeholder="Enter subject name"
                />
                <error-message
                    ngDefaultControl
                    [formControl]="newSubject"
                ></error-message>
            </div>
        </form>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="onSubmitNewSubject(modal)">save</button>
    </div>
</ng-template>
<div (click)="setUneditable($event)">
    <div class="container" *ngIf="true">
        <mat-stepper [linear]="true" #stepper class="bg-light">
            <!-- Step 1: Assessment Info -->
            <mat-step [stepControl]="assessmentDetailFormGroup" label="Details">
                <form [formGroup]="assessmentDetailFormGroup">
                    <div class="form-group">
                        <label for="assessmentName">Assessment Name</label>
                        <input
                            type="text"
                            class="form-control"
                            formControlName="assessmentName"
                            id="assessmentName"
                            placeholder="Enter assessment name"
                            name="assessmentName"
                        />
                        <error-message
                            ngDefaultControl
                            [formControl]="assessmentName"
                        ></error-message>
                    </div>
                    <div class="form-group">
                        <label for="assessmentType">Assessment Type</label>
                        <select
                            class="form-select"
                            name="assessmentTypes"
                            id="assessmentTypes"
                            formControlName="assessmentType"
                        >
                            <option
                                *ngFor="let type of assessmentTypes"
                                [value]="type"
                                [selected]="
                                    type == 'essay_based' ? true : false
                                "
                            >
                                {{ type }}
                            </option>
                        </select>
                        <error-message
                            ngDefaultControl
                            [formControl]="assessmentType"
                        ></error-message>
                    </div>
                    <div class="form-group">
                        <label for="subject">Subject</label>
                        <select
                            class="form-select"
                            name="subject"
                            id="subject"
                            formControlName="subject"
                        >
                            <option
                                *ngFor="let subject of subjects"
                                [value]="subject.id"
                            >
                                {{ subject.name }}
                            </option>
                        </select>
                        <button (click)="openModal(subjectCreationModal)" class="btn btn-link">
                            + create a new subject
                        </button>
                        <error-message
                            ngDefaultControl
                            [formControl]="subject"
                        ></error-message>
                    </div>
                    <div class="form-group">
                        <label for="defaultSetting">Default Setting</label>
                        <select
                            class="form-select"
                            name="defaultSetting"
                            id="defaultSetting"
                            formControlName="defaultSetting"
                        >
                            <option
                                *ngFor="let setting of markingSettings"
                                [value]="setting"
                            >
                                {{ setting }}
                            </option>
                        </select>
                        <error-message
                            ngDefaultControl
                            [formControl]="defaultSetting"
                        ></error-message>
                    </div>
                    <div>
                        <button
                            class="btn btn-primary"
                            matStepperNext
                            (click)="validateForm(assessmentDetailFormGroup)"
                        >
                            Next
                        </button>
                    </div>
                </form>
            </mat-step>
            
            <!-- Step 2: Question -->
            <mat-step [stepControl]="questionFormGroup" label="Questions">
                <form [formGroup]="questionFormGroup" id="questionForm">
                    <div class="form-group d-flex align-items-center mt-2">
                        <label for="totalMark" class="mr-4">Total Mark</label>
                        <input
                            type="text"
                            class="form-control w-25 d-block ml-auto"
                            id="totalMark"
                            name="totalMark"
                            value="{{ getTotalMark() }}"
                            disabled
                        />
                    </div>
                </form>

                <button
                    class="btn btn-primary d-block ml-auto"
                    (click)="addQuestion()"
                >
                    + Add Question
                </button>

                <table
                    mat-table
                    [dataSource]="questions"
                    class="mat-elevation-z8 w-100 my-4"
                >
                    <ng-container matColumnDef="drag">
                        <th mat-header-cell *matHeaderCellDef style="width: 5%">
                            Drag
                        </th>
                        <td mat-cell *matCellDef="let element">
                            <fa-icon [icon]="faEllipsisV"></fa-icon>
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="no">
                        <th
                            mat-header-cell
                            *matHeaderCellDef
                            style="width: 10%"
                        >
                            No.
                        </th>
                        <td mat-cell *matCellDef="let element">
                            <span *ngIf="!element.isEdit">
                                {{ element.no }}
                            </span>
                            <span *ngIf="element.isEdit">
                                <input
                                    type="text"
                                    class="form-control"
                                    [(ngModel)]="element.no"
                                />
                            </span>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="question">
                        <th
                            mat-header-cell
                            *matHeaderCellDef
                            style="width: 60%"
                        >
                            Questions
                        </th>
                        <td mat-cell *matCellDef="let element">
                            <span *ngIf="!element.isEdit">
                                {{ element.value.question }}
                            </span>
                            <span *ngIf="element.isEdit">
                                <input
                                    type="text"
                                    class="form-control"
                                    [(ngModel)]="element.value.question"
                                />
                            </span>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="marks">
                        <th
                            mat-header-cell
                            *matHeaderCellDef
                            style="width: 10%"
                        >
                            Marks
                        </th>
                        <td mat-cell *matCellDef="let element">
                            <span *ngIf="!element.isEdit">
                                {{ element.value.marks }}
                            </span>
                            <span *ngIf="element.isEdit">
                                <input
                                    type="number"
                                    class="form-control"
                                    [(ngModel)]="element.value.marks"
                                />
                            </span>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="actions">
                        <th
                            mat-header-cell
                            *matHeaderCellDef
                            style="width: 20%"
                        ></th>
                        <td mat-cell *matCellDef="let element">
                            <div *ngIf="!element.isEdit" class="text-end">
                                <button
                                    class="btn btn-link"
                                    (click)="deleteQuestion(element)"
                                >
                                    <fa-icon
                                        [icon]="faTrashAlt"
                                        style="color: red"
                                    ></fa-icon>
                                </button>
                                <button
                                    (click)="updateQuestion(element)"
                                    class="btn btn-outline-primary"
                                >
                                    Edit
                                </button>
                            </div>
                            <div *ngIf="element.isEdit" class="text-end">
                                <button
                                    (click)="updateQuestion(element)"
                                    class="btn btn-primary"
                                >
                                    Save
                                </button>
                            </div>
                        </td>
                    </ng-container>

                    <tr
                        mat-header-row
                        *matHeaderRowDef="questionDisplayedColumns"
                    ></tr>
                    <tr
                        mat-row
                        *matRowDef="let row; columns: questionDisplayedColumns"
                    ></tr>
                </table>
                <button matStepperPrevious class="btn btn-outline-primary mr-2">
                    Back
                </button>
                <button matStepperNext class="btn btn-primary">Next</button>
            </mat-step>

            <!-- Step 3: Rubrics -->
            <mat-step label="Rubrics">
                <app-rubrics-input #rubricsInput [(rubrics)]="rubrics" (rubrics)="testing()"></app-rubrics-input>
                <button matStepperPrevious class="btn btn-outline-primary mr-2">
                    Back
                </button>
                <button matStepperNext (click)="emitEvent()" class="btn btn-primary">Next</button>
            </mat-step>

            <mat-step label="Done">
                <p>You are now done.</p>
                <div>
                    <button class="btn btn-outline-primary mr-2" matStepperPrevious>Back</button>
                    <button class="btn btn-primary" (click)="onSubmit()">submit</button>
                </div>
            </mat-step>
        </mat-stepper>
    </div>
</div>

<ng-template #subjectCreationModal let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Create a new subject</h4>
        <button
            type="button"
            class="btn-close"
            aria-label="Close"
            (click)="modal.dismiss('Cross click')"
        ></button>
    </div>
    <div class="modal-body">
        <form [formGroup]="subjectFormGroup" id="subjectFormGroup">
            <div class="form-group">
                <label for="newSubject">Subject Name</label>
                <input
                    type="text"
                    class="form-control"
                    formControlName="newSubject"
                    id="newSubject"
                    placeholder="Enter subject name"
                />
                <error-message
                    ngDefaultControl
                    [formControl]="newSubject"
                ></error-message>
            </div>
        </form>
    </div>
    <div class="modal-footer">
        <button
            type="button"
            class="btn btn-primary"
            (click)="onSubmitNewSubject(modal)"
        >
            save
        </button>
    </div>
</ng-template>
<div (click)="setUneditable($event)">
    <div class="container" *ngIf="true">
        <mat-stepper [linear]="true" #stepper class="bg-light">
            <!-- Step 1: Assessment Info -->
            <mat-step [stepControl]="assessmentDetailFormGroup" label="Details">
                <form [formGroup]="assessmentDetailFormGroup">
                    <div class="form-group">
                        <label for="assessmentName">Assessment Name</label>
                        <input
                            type="text"
                            class="form-control"
                            formControlName="assessmentName"
                            id="assessmentName"
                            placeholder="Enter assessment name"
                            name="assessmentName"
                        />
                        <error-message
                            ngDefaultControl
                            [formControl]="assessmentName"
                        ></error-message>
                    </div>
                    <div class="form-group">
                        <label for="assessmentType">Assessment Type</label>
                        <select
                            class="form-select"
                            name="assessmentTypes"
                            id="assessmentTypes"
                            formControlName="assessmentType"
                        >
                            <option
                                *ngFor="let type of assessmentTypes"
                                [value]="type"
                                [selected]="
                                    type == 'essay_based' ? true : false
                                "
                            >
                                {{ type }}
                            </option>
                        </select>
                        <error-message
                            ngDefaultControl
                            [formControl]="assessmentType"
                        ></error-message>
                    </div>
                    <div class="form-group">
                        <label for="subject">Subject</label>
                        <select
                            class="form-select"
                            name="subject"
                            id="subject"
                            formControlName="subject"
                        >
                            <option
                                *ngFor="let subject of subjects"
                                [value]="subject.id"
                            >
                                {{ subject.name }}
                            </option>
                        </select>
                        <button
                            (click)="openModal(subjectCreationModal)"
                            class="btn btn-link"
                        >
                            + create a new subject
                        </button>
                        <error-message
                            ngDefaultControl
                            [formControl]="subject"
                        ></error-message>
                    </div>
                    <div class="form-group">
                        <label for="defaultSetting">Default Setting</label>
                        <select
                            class="form-select"
                            name="defaultSetting"
                            id="defaultSetting"
                            formControlName="defaultSetting"
                        >
                            <option
                                *ngFor="let setting of markingSettings"
                                [value]="setting"
                            >
                                {{ setting }}
                            </option>
                        </select>
                        <error-message
                            ngDefaultControl
                            [formControl]="defaultSetting"
                        ></error-message>
                    </div>
                    <div>
                        <button
                            class="btn btn-primary"
                            matStepperNext
                            (click)="validateForm(assessmentDetailFormGroup)"
                        >
                            Next
                        </button>
                    </div>
                </form>
            </mat-step>

            <!-- Step 2: Question -->
            <mat-step [stepControl]="questionFormGroup" label="Questions">
                <app-question-input
                    #questionsInput
                    [(questions)]="questions"
                    [isEditingMode]="true"
                ></app-question-input>
                <button matStepperPrevious class="btn btn-outline-primary mr-2">
                    Back
                </button>
                <button
                    matStepperNext
                    class="btn btn-primary"
                    (click)="emitQuestionInputEvent()"
                >
                    Next
                </button>
            </mat-step>

            <!-- Step 3: Rubrics -->
            <mat-step label="Rubrics">
                <app-rubrics-input
                    #rubricsInput
                    [(rubrics)]="rubrics"
                    [isEditingMode]="true"
                ></app-rubrics-input>
                <button matStepperPrevious class="btn btn-outline-primary mr-2">
                    Back
                </button>
                <button
                    matStepperNext
                    (click)="emitRubricsInputEvent()"
                    class="btn btn-primary"
                >
                    Next
                </button>
            </mat-step>

            <!-- Step 4: Review -->
            <mat-step label="Review">
                <table class="table">
                    <tbody>
                        <tr>
                            <th>Assessment Name</th>
                            <td>
                                {{
                                    assessmentDetailFormGroup.value
                                        .assessmentName
                                }}
                            </td>
                        </tr>
                        <tr>
                            <th>Assessment Type</th>
                            <td>
                                {{
                                    assessmentDetailFormGroup.value
                                        .assessmentType
                                }}
                            </td>
                        </tr>
                        <tr>
                            <th>Subject</th>
                            <td>
                                {{ selectedSubjectName }}
                            </td>
                        </tr>
                        <tr>
                            <th>Default Marking Setting</th>
                            <td>
                                {{
                                    assessmentDetailFormGroup.value
                                        .defaultSetting
                                }}
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <strong> Questions </strong>
                                <app-question-input
                                    [(questions)]="questions"
                                    [isEditingMode]="false"
                                ></app-question-input>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <strong>Rubrics</strong>
                                <app-rubrics-input
                                    [isEditingMode]="false"
                                    [(rubrics)]="rubrics"
                                ></app-rubrics-input>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div>
                    <button
                        class="btn btn-outline-primary mr-2"
                        matStepperPrevious
                    >
                        Back
                    </button>
                    <button class="btn btn-primary" (click)="onSubmit()">
                        submit
                    </button>
                </div>
            </mat-step>
        </mat-stepper>
    </div>
</div>
